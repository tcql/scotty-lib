/*! scotty-lib - v1.0.0 - 2014-03-20 */
(function(){var nedb,project,storage,__bind=function(fn,me){return function(){return fn.apply(me,arguments)}};project=require("./project").project,storage=require("./storage").storage,nedb=require("nedb"),exports.manager=function(){function manager(options){this.options=options,this.getDefaultTemplate=__bind(this.getDefaultTemplate,this),this.boot=__bind(this.boot,this)}return manager.prototype.boot=function(){return this._projectdb=new nedb({filename:this.options.project_file,autoload:this.options.autoload}),this._project_files=new project(this.options),this.projects=new storage(this._projectdb)},manager.prototype.create=function(project,options,callback){return null==callback&&(callback=function(){}),this.projects.nameInUse(project.name,function(_this){return function(exists){return exists&&callback(["A project with that name already exists"],null),_this._project_files.createOnDiskByCopy(project,_this.getDefaultTemplate()),_this._project_files.installPhaser(project),_this.projects.add(project,callback)}}(this))},manager.prototype.update=function(id,project,callback){return null==callback&&(callback=function(){}),this.projects.getById(id,function(_this){return function(err,old){return err?callback(err,null):(old.path!==project.path&&_this._project_files.moveOnDisk(old,project),old.phaser_version!==project.phaser_version&&(_this._project_files.uninstallPhaser(old),_this._project_files.installPhaser(project)),_this.projects.update(project,callback))}}(this))},manager.prototype["delete"]=function(id,callback){return null==callback&&(callback=function(){}),this.projects.getById(id,function(_this){return function(err,project){return err&&callback(err,null),_this.projects.deleteById(id,function(err,numDel){return err&&callback(err,null),numDel>0&&_this._project_files.deleteOnDisk(project),callback(null,project)})}}(this))},manager.prototype.getDefaultTemplate=function(){return this.options.template_path+"/hello_phaser"},manager}()}).call(this);