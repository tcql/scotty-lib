/*! scotty-lib - v1.0.0 - 2014-03-20 */
(function(){var checker,fetcher,github,nedb,storage;fetcher=require("./fetcher").fetcher,checker=require("./checker").checker,storage=require("./storage").storage,nedb=require("nedb"),github=require("github"),exports.manager=function(){function manager(options){this.options=null!=options?options:{}}return manager.prototype.boot=function(){var _ref;return this.api||(this.api=new github({version:"3.0.0",debug:null!=(_ref=this.options.debug)?_ref:!1,protocol:"https"})),this.checker=new checker,this.fetcher=new fetcher(this.api,this.checker),this._versiondb=new nedb({filename:this.options.version_file,autoload:this.options.autoload}),this.versions=new storage(this._versiondb,this.checker)},manager.prototype.fetch=function(callback){return this.fetcher.fetchVersions(function(_this){return function(versions){return _this.versions.syncVersionList(versions,callback)}}(this))},manager.prototype.forceDownload=function(version,cb){return this._download(version,cb)},manager.prototype.download=function(version,callback){return this.versions.isInstalled(version,function(_this){return function(exists){return exists?callback(!1):_this._download(version,callback)}}(this))},manager.prototype._download=function(version,callback){return this.versions.get(version,function(_this){return function(err,ver){var request;return ver?request=_this.fetcher.download(version,ver.url,_this.options.phaser_path,function(){return _this.versions.install(version,callback)}):callback(!1)}}(this))},manager.prototype.setChecker=function(){return this.checker=check},manager.prototype.setFile=function(local){return this.file=local},manager.prototype.setFetcher=function(fetcher){return this.fetcher=fetcher},manager.prototype.setDb=function(db){return this._versiondb=db,this.versions.db=db},manager.prototype.setApi=function(api){return this.api=api},manager}()}).call(this);